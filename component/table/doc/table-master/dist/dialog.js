!function(t,i){"function"==typeof define&&define.amd?define(["$"],i):"object"==typeof exports?module.exports=i():t.Dialog=i(window.Zepto||window.jQuery||$)}(this,function(t){t.fn.Dialog=function(e){var s=[];return t(this).each(function(){var n=new i,o=t.extend({trigger:t(this)},e);n.init(o),s.push(n)}),s},t.Dialog=function(e){if("alert"===e.type){var s=new i,n='<div class="ui-alert-title">'+e.content+"</div>",o="";e.button?("boolean"==typeof e.button&&(e.button="确定"),o='<p class="ui-dialog-action"><button class="ui-alert-submit  js-dialog-close">'+e.button+"</button></p>"):e.timer||(e.timer=3e3),n+=o;var a=t.extend({target:n,animate:!0,show:!0,mask:!0,className:"ui-alert",afterHide:function(t){this.dispose(),e.callback&&e.callback()}},e);s.init(a),e.timer&&setTimeout(function(){s.dispose(),e.callback&&e.callback()},e.timer),s.touch(s.mask,function(){s.hide(),e.callback&&e.callback()})}if("confirm"===e.type){var h=new i,n='<div class="ui-confirm-title">'+e.content+"</div>",o="";e.buttons||(e.buttons=[{yes:"确定"},{no:"取消"}]);for(var l="",d=0,c=e.buttons.length;c>d;d++){var r=e.buttons[d];r.yes&&(l+='<td><button class="ui-confirm-submit " data-type="yes">'+r.yes+"</button></td>"),r.no&&(l+='<td><button class="ui-confirm-no" data-type="no">'+r.no+"</button></td>"),r.close&&(l+='<td><button class="ui-confirm-close js-dialog-close" data-type="close">'+r.close+"</button></td>")}o='<table class="ui-dialog-action"><tr>'+l+"</tr></table>",n+=o;var g=t.extend({target:n,animate:!0,show:!0,mask:!0,className:"ui-alert",afterHide:function(t){this.dispose()},beforeShow:function(i){h.touch(t(".ui-confirm-submit",i),function(){e.callback&&e.callback.call(h,"yes",i)}),h.touch(t(".ui-confirm-no",i),function(){e.callback&&e.callback.call(h,"no",i)}),h.touch(t(".ui-confirm-close",i),function(){e.callback&&e.callback.call(h,"close",i)})}},e);h.init(g)}},t.alert=function(i,e,s,n,o){var a={},h={zIndex:100,type:"alert"};a="object"==typeof i?t.extend(h,i):t.extend(h,{content:i,button:e,timer:n,callback:s}),t.Dialog(t.extend(a,o))},t.confirm=function(i,e,s,n){var o={},a={zIndex:100,type:"confirm"};o="object"==typeof i?t.extend(a,i):t.extend(a,{content:i,buttons:e,callback:s}),t.Dialog(t.extend(o,n))};var i=function(){var i=Math.random().toString().replace(".","");this.id="dialog_"+i,this.settings={},this.settings.closeTpl=t('<span class="ui-dialog-close js-dialog-close">x</span>'),this.settings.titleTpl=t('<div class="ui-dialog-title"></div>'),this.timer=null,this.showed=!1,this.mask=t()};return i.prototype={init:function(i){this.settings=t.extend({},this.settings,i),this.settings.mask&&(this.mask=t('<div class="ui-dialog-mask"/>'),t("body").append(this.mask)),t("body").append('<div class="ui-dialog" id="'+this.id+'"></div>'),this.dialogContainer=t("#"+this.id);var e=this.settings.zIndex||10;this.dialogContainer.css({zIndex:e}),this.settings.className&&this.dialogContainer.addClass(this.settings.className),this.mask.css({zIndex:e-1}),this.settings.closeTpl&&this.dialogContainer.append(this.settings.closeTpl),this.settings.title&&(this.dialogContainer.append(this.settings.titleTpl),this.settings.titleTpl.html(this.settings.title)),this.bindEvent(),this.settings.show&&this.show()},touch:function(i,e){function s(t){return e.call(this,t)}var n;t(i).on("click",s),t(i).on("touchmove",function(t){n=!0}).on("touchend",function(t){if(t.preventDefault(),!n){var i=e.call(this,t,"touch");i||(t.preventDefault(),t.stopPropagation())}n=!1})},bindEvent:function(){var i=this;this.settings.trigger&&(t(this.settings.trigger).click(function(){i.show()}),i.touch(t(this.settings.trigger),function(){i.show()})),t(this.dialogContainer).on("click",".js-dialog-close",function(){return i.hide(),!1}),t(document).keydown(function(t){console.log(t.keyCode),27===t.keyCode&&i.showed&&i.hide()})},dispose:function(){this.dialogContainer.remove(),this.mask.remove(),this.timer&&clearInterval(this.timer)},hide:function(){var i=this;i.settings.beforeHide&&i.settings.beforeHide.call(i,i.dialogContainer),this.showed=!1,this.mask.hide(),this.timer&&clearInterval(this.timer),this.settings.animate?(this.dialogContainer.removeClass("zoomIn").addClass("zoomOut"),setTimeout(function(){i.dialogContainer.hide(),"object"==typeof i.settings.target&&t("body").append(i.dialogContainer.hide()),i.settings.afterHide&&i.settings.afterHide.call(i,i.dialogContainer)},500)):(this.dialogContainer.hide(),"object"==typeof this.settings.target&&t("body").append(this.dialogContainer),this.settings.afterHide&&this.settings.afterHide.call(this,this.dialogContainer))},show:function(){this.dailogContent="string"==typeof this.settings.target?t(/^(\.|\#\w+)/gi.test(this.settings.target)?this.settings.target:"<div>"+this.settings.target+"</div>"):this.settings.target,this.mask.show(),this.dailogContent.show(),this.height=this.settings.height||"auto",this.width=this.settings.width||"auto",this.dialogContainer.append(this.dailogContent).show().css({height:this.height,width:this.width}),this.settings.beforeShow&&this.settings.beforeShow.call(this,this.dialogContainer),this.showed=!0,t(this.settings.trigger).blur(),this.setPosition();var i=this;this.timer&&clearInterval(this.timer),this.timer=setInterval(function(){i.setPosition()},1e3),this.settings.animate&&this.dialogContainer.addClass("zoomIn").removeClass("zoomOut").addClass("animated")},setPosition:function(){if(this.showed){var t=this;this.dialogContainer.show(),this.height=this.settings.height,this.width=this.settings.width,isNaN(this.height)&&(this.height=this.dialogContainer.outerHeight&&this.dialogContainer.outerHeight()||this.dialogContainer.height()),isNaN(this.width)&&(this.width=this.dialogContainer.outerWidth&&this.dialogContainer.outerWidth()||this.dialogContainer.width());var i=this.settings.clientHeight||document.documentElement.clientHeight||document.body.clientHeight,e=this.settings.clientWidth||document.documentElement.clientWidth||document.body.clientWidth,s=this.width/2,n=this.height/2,o=e/2-s,a=i/2-n;o=Math.floor(Math.max(0,o)),a=Math.floor(Math.max(0,a)),t.dialogContainer.css({position:"fixed",top:a,left:o})}}},i});